!function(t){"use strict";t(document).ready(function(){e.init()});const e={init:function(){this.bindEvents()},bindEvents:function(){t(document).on("submit",".todoistberg-form",this.handleFormSubmit),t(document).on("click",".todoistberg-task",this.handleTaskClick)},handleFormSubmit:function(s){s.preventDefault();const o=t(this),n=o.find(".todoistberg-task-input"),a=o.find(".todoistberg-submit-btn"),i=o.siblings(".todoistberg-form-message"),d=o.closest(".todoistberg-todo-form"),r=n.val().trim(),c=d.data("project-id");r?(a.prop("disabled",!0).text("Adding..."),e.showMessage(i,"Adding task...","loading"),t.ajax({url:todoistbergFrontend.ajaxUrl,type:"POST",data:{action:"todoistberg_add_task",task_content:r,project_id:c,nonce:todoistbergFrontend.nonce},success:function(t){t.success?(e.showMessage(i,"Task added successfully!","success"),n.val(""),e.refreshNearbyLists(d)):e.showMessage(i,t.data||"Failed to add task.","error")},error:function(){e.showMessage(i,"Network error. Please try again.","error")},complete:function(){a.prop("disabled",!1).text(a.data("original-text")||"Add Task")}})):e.showMessage(i,"Please enter a task description.","error")},handleTaskClick:function(e){const s=t(this),o=s.data("task-id");if(!o)return;const n=!s.hasClass("completed");s.addClass("updating"),t.ajax({url:todoistbergFrontend.ajaxUrl,type:"POST",data:{action:"todoistberg_toggle_task",task_id:o,completed:n,nonce:todoistbergFrontend.nonce},success:function(t){t.success?n?s.addClass("completed"):s.removeClass("completed"):(n?s.removeClass("completed"):s.addClass("completed"),console.error("Failed to update task:",t.data))},error:function(){n?s.removeClass("completed"):s.addClass("completed"),console.error("Network error updating task")},complete:function(){s.removeClass("updating")}})},showMessage:function(t,e,s){t.removeClass("success error loading").addClass(s).html("<p>"+e+"</p>").show(),"success"===s&&setTimeout(function(){t.fadeOut()},3e3)},refreshNearbyLists:function(s){const o=t(".todoistberg-todo-list").not(s.find(".todoistberg-todo-list"));o.length>0&&o.each(function(){const s=t(this),o=s.data("project-id");o&&e.refreshTaskList(s,o)})},refreshTaskList:function(e,s){const o=e.find(".todoistberg-tasks"),n=e.find(".todoistberg-no-tasks");o.html('<li class="todoistberg-loading">Loading...</li>'),t.ajax({url:todoistbergFrontend.ajaxUrl,type:"POST",data:{action:"todoistberg_get_tasks",project_id:s,nonce:todoistbergFrontend.nonce},success:function(t){if(t.success&&t.data.tasks){const e=t.data.tasks;if(0===e.length)o.hide(),n.show();else{n.hide(),o.show();const t=e.map(function(t){const e=t.completed?"completed":"",s=t.due?'<span class="todoistberg-task-due">'+new Date(t.due.date).toLocaleDateString()+"</span>":"";return'<li class="todoistberg-task '+e+'" data-task-id="'+t.id+'"><span class="todoistberg-task-content">'+t.content+"</span>"+s+"</li>"}).join("");o.html(t)}}},error:function(){o.html('<li class="todoistberg-error">Failed to load tasks</li>')}})},formatDate:function(t){return new Date(t).toLocaleDateString()},debounce:function(t,e){let s;return function(...o){clearTimeout(s),s=setTimeout(()=>{clearTimeout(s),t(...o)},e)}}};window.TodoistbergFrontend=e}(jQuery);